<!DOCTYPE html>
<html>

<head>
    <title>Pilot Anxiety</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="lib/jquery.mobile-1.3.2.min.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="lib/jquery-2.0.3.min.js"></script>
    <script>
        $(document).bind("mobileinit", function () {
            $.mobile.defaultPageTransition = 'none';
        });
    </script>

    <script src="lib/jquery.mobile-1.3.2.min.js"></script>
    <script src='js/exercises.js'></script>
    <script src="phonegap.js"></script>
    <script src="device.js"></script>
    <script src="local-notification.js"></script>

</head>

<body onload="init()">

    <div class='background_home'>
    </div>
    
    <div data-role="footer" style='position:absolute;bottom: 0;width:100%;height : 38px;'>
        <div data-role="navbar">
            <ul>
                <li>
                    <a href="#popupContent" data-rel="popup" data-position-to="window">Content</a>
                </li>
                <li>
                    <a href="#popupProgress" onclick='update_progress();' data-rel="popup" data-position-to="window">Progress</a>
                </li>
                <li>
                    <a href="exercises/exercise_7.html">Exercises</a>
                </li>
                <li>
                    <a href="#popuphelp" data-rel="popup" data-position-to="window">HELP</a>
                </li>
            </ul>
        </div><!-- /navbar -->
    </div>
    


    <div data-role="popup" id="popuphelp" data-theme="a">
        <a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>

    </div>

    <div data-role="popup" id="popupContent" data-theme="a" >
        <a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
        
        <div data-role= "header" style='position:relative ; top: 0;width:100%;height : 38px;'>
            <div data-role="navbar">
                <ul>
                    <li>
                        <a href="#" onclick="showContent();" class="ui-btn-active"> Content </a>
                    </li>
                    <li>
                        <a href="#" onclick="showExercises();"> Exercises </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <ul data-role="listview" id="list_content">
            <div data-role="collapsible" data-theme="c" data-content-theme="a" data-iconpos="right">
                <h3>What is Social Anxiety? </h3>
                <ul data-role="listview" data-divider-theme="a" >
                    <li> <a href="sections/section_1_1.html">Introduction</a></li>
                    <li> <a href="sections/section_1_2.html">Defining Shyness and Social Anxiety</a></li>
                    <li> <a href="sections/section_1_3.html">Fusion vs. Defusion</a></li>
                </ul>
            </div>

            <div data-role="collapsible" data-theme="c" data-content-theme="a" data-iconpos="right">
                <h3>Anxious Thinking</h3>
                <ul data-role="listview" data-divider-theme="a" >
                    <li> <a href="sections/section_2_1.html">Types of Anxious Thinking</a></li>
                    <li> <a href="sections/section_2_2.html">Types of Anxious Thinking Cont'd</a></li>
                    <li> <a href="sections/section_2_3.html">Your Types of Anxious Thinking</a></li>
                </ul>
            </div>

            <div data-role="collapsible" data-theme="c" data-content-theme="a" data-iconpos="right">
                <h3>Defusing from Your Socially Anxious Thoughts</h3>
                <ul data-role="listview" data-divider-theme="a" >
                    <li> <a href="sections/section_3_1.html">Defusion Strategies</a></li>
                    <li> <a href="sections/section_3_2.html">Defusion Strategies Cont'd</a></li>
                </ul>
            </div>

            <div data-role="collapsible" data-theme="c" data-content-theme="a" data-iconpos="right">
                <h3>Awareness of Thinking</h3>
                <ul data-role="listview" data-divider-theme="a" >
                    <li> <a href="sections/section_4_1.html">Developing Your Awareness of Thinking</a></li>
                    <li> <a href="sections/section_4_2.html">Exercise 6: Awareness of Thinking</a></li>
                </ul>
            </div>

            <div data-role="collapsible" data-theme="c" data-content-theme="a" data-iconpos="right">
                <h3>Summary of Defusion Strategies</h3>
                <ul data-role="listview" data-divider-theme="a" >
                    <li> <a href="sections/section_5.html">Summary of Defusion Strategies</a></li>

                </ul>
            </div>
        </ul>
        
        <ul data-role="listview" id="list_exercises">
            <li>
                <a href="exercises/exercise_1.html">
                Exercise 1: Top Feared Social Situations
                </a>
            </li>
            <li>
                <a href="exercises/exercise_2.html">
                    Exercise 2: Your Anxious Thoughts
                </a>
            </li>
            <li>
                <a href="exercises/exercise_3.html">
                    Exercise 3: "Shoulding"
                </a>
            </li>
            <li>
                <a href="exercises/exercise_4.html">
                    Exercise 4: Generating Stories
                </a>
            </li>
            <li>
                <a href="exercises/exercise_5.html">
                    Exercise 5: Types of Anxious Thinking
                </a>
            </li>
            <li>
                <a href="exercises/exercise_6.html">
                    Exercise 6: Awareness of Thinking
                </a>
            </li>
        </ul>
        
    </div>



    <div data-role="popup" id="popupProgress" data-theme="a">
        <a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
         <div id='progress_percent'><p>Progress Completed:70%</p></div>
        <meter id='progres_bar' value="0" min="0" max="16" style="width:100%;height:2em;margin:0px 0px 0px 0px;"></meter>


    </div>
    
    <script>

        document.addEventListener('deviceready', function () {
            // window.plugin.notification.local is now available
        }, false);

        //total/daily usage changes 
        if (localStorage['usage']) {
            localStorage['usage'] = parseInt(localStorage['usage']) + 1;

            var date = new Date().setHours(0,0,0,0);
            var init_date = parseInt(localStorage['init_date']);
            var difference = parseInt((date.getTime() - init_date.getTime()) / 86400000);

            if (difference <= 6) {
                localStorage['day_'+difference] = parseInt(localStorage['day_'+difference]) + 1;
            }
        } else {
            localStorage['usage'] = 1;

        }
        
        function init() {
            if (!localStorage['init']) {
                localStorage['audio'] = true;
                var init_date = new Date().setHours(0,0,0,0);
                localStorage['init_date'] = init_date

                localStorage['day_0'] = 1
                localStorage['day_1'] = 0
                localStorage['day_2'] = 0
                localStorage['day_3'] = 0
                localStorage['day_4'] = 0
                localStorage['day_5'] = 0
                localStorage['day_6'] = 0

                //Set timer for notifications
                var first = new Date();
                first.setHours(10,0,0,0);
                
                var secondDay = new Date();
                secondDay.setTime(first.getTime()+86400000);

                var thirdDay = new Date();
                thirdDay.setTime(thirdDay.getTime()+86400000);

                var fourthDay = new Date();
                fourthDay.setTime(FourthDay.getTime()+86400000);

                var fifthDay = new Date();
                fifthDay.setTime(fifthDay.getTime()+86400000);

                var sixthDay = new Date();
                sixthDay.setTime(sixthDay.getTime()+86400000);

                var seventhDay = new Date();
                seventhDay.setTime(seventhDay.getTime()+86400000);

                window.plugin.notification.local.add({ 
                    id:         1, // is converted to a string
                    title:      'Reminder',
                    message:    'Go through your defusion material!',
                    date:       first,
                    //repeat:     'daily'
                });

                window.plugin.notification.local.add({ 
                    id:         2, // is converted to a string
                    title:      'Reminder',
                    message:    'Go through your defusion material!',
                    date:       secondDay,
                    //repeat:     'daily'
                });

                window.plugin.notification.local.add({ 
                    id:         3, // is converted to a string
                    title:      'Reminder',
                    message:    'Go through your defusion material!',
                    date:       thirdDay,
                    //repeat:     'daily'
                });

                window.plugin.notification.local.add({ 
                    id:         4, // is converted to a string
                    title:      'Reminder',
                    message:    'Go through your defusion material!',
                    date:       fourthDay,
                    //repeat:     'daily'
                });

                window.plugin.notification.local.add({ 
                    id:         5, // is converted to a string
                    title:      'Reminder',
                    message:    'Go through your defusion material!',
                    date:       fifthDay,
                    //repeat:     'daily'
                });

                window.plugin.notification.local.add({ 
                    id:         6, // is converted to a string
                    title:      'Reminder',
                    message:    'Go through your defusion material!',
                    date:       sixthDay,
                    //repeat:     'daily'
                });

                window.plugin.notification.local.add({ 
                    id:         7, // is converted to a string
                    title:      'Reminder',
                    message:    'Go through your defusion material!',
                    date:       seventhDay,
                    //repeat:     'daily'
                });
    
                localStorage['init'] = true;

            }
        }
        var devicePlatform;
        function clear_Storage() {
            localStorage.clear();
        }

        function getRealContentHeight() {
            var viewport_height = $(window).height();
            var content_height = viewport_height;
            return content_height;
        }
        $('.background_home').height(getRealContentHeight()-40);
        function update_progress() {
            var progress = 0;
            var total = 16;

            //exercise 1
            if (localStorage['exercise_1']) {
                var exercise_1 = JSON.parse(localStorage['exercise_1']);
                for (var i = 1; i <= 3; i++) {
                    if (exercise_1['fear_'+i].length>0) {
                        progress ++;
                    }
                }
            }
            //exercise 2
            if (localStorage['exercise_2']) {
                var exercise_2 = JSON.parse(localStorage['exercise_2']);
                for (var i = 1; i <= 3; i++) {
                    if (exercise_2['thought_'+i].length>0) {
                        progress ++;
                    }
                }
            }
            //exercise 4
            if (localStorage['exercise_4']) {
                var exercise_4 = JSON.parse(localStorage['exercise_4']);
                for (var i = 1; i<=6; i++) {
                    if (exercise_4['story_'+i]) {
                        progress ++;
                    }           
                }
            }
            //exercise 5
            if (localStorage['exercise_5']) {
                var exercise_5 = JSON.parse(localStorage['exercise_5']);

                for (var i = 1; i<=3; i++) {
                    $("#fear_type_"+i).val(exercise_5['fear_type_'+i]).attr('selected', true)
                    if (exercise_5['fear_type_'+i]) {
                        progress ++;
                    }
                } 
            }
            //exercise 7
            if (localStorage['exercise_7']) {
                var exercise_7 = JSON.parse(localStorage['exercise_7']);
                if ((exercise_7['exercise_7_thought_1'].length > 0) && (exercise_7['exercise_7_notice_1'].length > 0) && (exercise_7['exercise_7_strategy_1'] != 'none')) {
                    progress ++;
                }
            }
            var pBar = document.getElementById('progres_bar');
            var pPer = document.getElementById('progress_percent');
            
            var html_string = "<p> Progress Completed:"+progress/16*100+"% <br><br>Usage: "+localStorage['usage']+"</p>";
            if (localStorage['init_date']) {
                html_string += "<p>1: "+localStorage['day_0'] +"</p>";
                html_string += "<p>2: "+localStorage['day_1'] +"</p>";
                html_string += "<p>3: "+localStorage['day_2'] +"</p>";
                html_string += "<p>4: "+localStorage['day_3'] +"</p>";
                html_string += "<p>5: "+localStorage['day_4'] +"</p>";
                html_string += "<p>6: "+localStorage['day_5'] +"</p>";
                html_string += "<p>7: "+localStorage['day_6'] +"</p>";  
            }

            pPer.innerHTML = html_string;
            pBar.value = progress;

        }
        
        $("#list_content").show();
        $("#list_exercises").hide();
        function showContent(){
            $("#list_exercises").hide();
            $("#list_content").show();
        }
        
        function showExercises(){
            $("#list_content").hide();
            $("#list_exercises").show();
        }
    </script>

</body>

</html>
